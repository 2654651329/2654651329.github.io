<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è¯¾å ‚éšæœºç‚¹å</title>
    <style>
        body {
            background-color: #F9F3F3;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
        }

        h1 {
            color: #FF9A8B;
            font-size: 2.5em;
            text-shadow: 2px 2px #FFD6D6;
            margin: 20px 0;
        }

        #name-display {
            width: 80%;
            height: 300px;
            background-color: #FFF5EB;
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            padding: 20px;
        }

        #name-text {
            font-family: 'æ¥·ä½“', cursive;
            font-size: 48px;
            color: #7A77FF;
            transition: all 0.3s ease;
            text-align: center;
        }

        .highlight {
            font-size: 60px !important;
            color: #FF6B6B !important;
        }

        button {
            background-color: #8AFF8A;
            color: #4B4B4B;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
            margin: 10px;
        }

        button:hover {
            background-color: #75D475;
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.95);
        }

        .control-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 80%;
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            height: 100px;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #FFD6D6;
            font-size: 16px;
        }

        .file-input {
            margin: 10px 0;
        }

        .student-list {
            width: 80%;
            margin-top: 20px;
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h1>ğŸ‰ é™ˆè€å¸ˆè¯¾å ‚éšæœºç‚¹å ğŸ‰</h1>
    
    <div class="control-panel">
        <div>
            <button id="load-default-btn">åŠ è½½é»˜è®¤åå•</button>
            <button id="load-file-btn">ä»æ–‡ä»¶å¯¼å…¥åå•</button>
            <input type="file" id="file-input" class="file-input" accept=".txt,.csv" style="display: none;">
        </div>
        <textarea id="name-input" placeholder="è¯·è¾“å…¥å­¦ç”Ÿåå•ï¼Œæ¯è¡Œä¸€ä¸ªåå­—æˆ–ä½¿ç”¨é€—å·åˆ†éš”"></textarea>
        <button id="update-btn">æ›´æ–°åå•</button>
    </div>
    
    <div id="name-display">
        <span id="name-text">è¯·å…ˆåŠ è½½å­¦ç”Ÿåå•</span>
    </div>
    
    <button id="action-btn">å¼€å§‹æŠ½äºº</button>
    
    <div class="student-list">
        <h3>å½“å‰å­¦ç”Ÿåå• (<span id="student-count">0</span>äºº):</h3>
        <div id="student-list-container"></div>
    </div>

    <script>
        // é»˜è®¤å­¦ç”Ÿåå•
        let students = [];
        let isRunning = false;
        let intervalId = null;
        const nameText = document.getElementById('name-text');
        const actionBtn = document.getElementById('action-btn');
        const nameInput = document.getElementById('name-input');
        const updateBtn = document.getElementById('update-btn');
        const loadDefaultBtn = document.getElementById('load-default-btn');
        const loadFileBtn = document.getElementById('load-file-btn');
        const fileInput = document.getElementById('file-input');
        const studentListContainer = document.getElementById('student-list-container');
        const studentCount = document.getElementById('student-count');

        // é»˜è®¤åå•
        const defaultStudents = [
            "ç‹äº¦è½©", "å‘¨æ¢“æ¡", "åˆ˜ä¾ä¾",
            "ç‹ä¿®ç„¶", "èµµæ¬£è¿ª", "è°­ç…¦èœ"
        ];

        function randomPick() {
            if (students.length === 0) return "æš‚æ— å­¦ç”Ÿåå•";
            return students[Math.floor(Math.random() * students.length)];
        }

        function toggleRoll() {
            if (students.length === 0) {
                alert("è¯·å…ˆåŠ è½½å­¦ç”Ÿåå•ï¼");
                return;
            }
            
            if(isRunning) {
                clearInterval(intervalId);
                nameText.classList.add('highlight');
                actionBtn.textContent = 'å¼€å§‹æŠ½äºº';
                isRunning = false;
            } else {
                nameText.classList.remove('highlight');
                intervalId = setInterval(() => {
                    nameText.textContent = randomPick();
                }, 50);
                actionBtn.textContent = 'æš‚åœæŠ½é€‰';
                isRunning = true;
            }
        }

        function updateStudentList() {
            studentListContainer.innerHTML = students.join(", ");
            studentCount.textContent = students.length;
        }

        function parseNames(input) {
        // æ”¯æŒæ¢è¡Œæˆ–ä¸­è‹±æ–‡é€—å·åˆ†éš”çš„åå­—
        let names = input.split(/[\n,ï¼Œ]/)
            .map(name => name.trim())
            .filter(name => name.length > 0);
        return names;
        }

        function loadDefaultList() {
            students = [...defaultStudents];
            nameInput.value = students.join("\n");
            updateStudentList();
            nameText.textContent = "åå•å·²åŠ è½½ï¼Œç‚¹å‡»å¼€å§‹æŠ½äºº";
        }

        function updateFromTextarea() {
            const names = parseNames(nameInput.value);
            if (names.length === 0) {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„å­¦ç”Ÿåå•ï¼");
                return;
            }
            students = names;
            updateStudentList();
            nameText.textContent = "åå•å·²æ›´æ–°ï¼Œç‚¹å‡»å¼€å§‹æŠ½äºº";
        }

        function loadFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    // æ–¹æ³•1ï¼šä½¿ç”¨TextDecoderå¤„ç†UTF-8ç¼–ç 
                    const content = new TextDecoder('utf-8').decode(new Uint8Array(e.target.result));
                    
                    // æ–¹æ³•2ï¼šæˆ–è€…ç›´æ¥æŒ‡å®šç¼–ç ï¼ˆéƒ¨åˆ†æµè§ˆå™¨æ”¯æŒï¼‰
                    // const content = e.target.result;
                    
                    nameInput.value = content;
                    students = parseNames(content);
                    updateStudentList();
                    nameText.textContent = "åå•å·²å¯¼å…¥ï¼Œç‚¹å‡»å¼€å§‹æŠ½äºº";
                } catch (error) {
                    console.error("æ–‡ä»¶è¯»å–é”™è¯¯:", error);
                    alert("æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·ç¡®ä¿æ˜¯UTF-8ç¼–ç çš„æ–‡æœ¬æ–‡ä»¶");
                }
            };
            
            // ä½¿ç”¨readAsArrayBufferè€Œä¸æ˜¯readAsText
            reader.readAsArrayBuffer(file);
            
            // æˆ–è€…å°è¯•æŒ‡å®šç¼–ç ï¼ˆå¦‚æœæµè§ˆå™¨æ”¯æŒï¼‰
            // reader.readAsText(file, 'UTF-8');
        }

        // äº‹ä»¶ç›‘å¬
        actionBtn.addEventListener('click', toggleRoll);
        updateBtn.addEventListener('click', updateFromTextarea);
        loadDefaultBtn.addEventListener('click', loadDefaultList);
        loadFileBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', loadFromFile);

        // åˆå§‹åŒ–
        updateStudentList();
    </script>
</body>
</html>
